<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + Material UI + TS + Tailwind CSS</title>
    <!-- Fonts to support Material Design -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
    />
    <!-- Immediate MetaMask Error Prevention -->
    <script>
      // Set up early error handling before any other scripts load
      window.addEventListener('unhandledrejection', function(event) {
        const error = event.reason;
        const message = (error && error.message) || error || '';

        // Catch all MetaMask-related errors including prefixed variants
        if (typeof message === 'string' && (
          message.includes('MetaMask') ||
          message.includes('Failed to connect to MetaMask') ||
          /s:\s*Failed to connect to MetaMask/i.test(message) || // "s: Failed to connect to MetaMask"
          /[a-z]:\s*.*MetaMask/i.test(message) || // Any "x: ...MetaMask" pattern
          message.includes('ethereum') ||
          message.includes('chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn') ||
          (error && error.code === 4001) || // User rejected
          (error && error.code === -32002) // Request pending
        )) {
          event.preventDefault();
          console.warn('[CRM] MetaMask extension detected but not needed for this application');
          return;
        }
      });

      // Disable MetaMask as soon as window.ethereum becomes available
      Object.defineProperty(window, 'ethereum', {
        get: function() { return this._ethereum; },
        set: function(value) {
          if (value && typeof value === 'object') {
            try {
              // Disable auto-detection and connection features
              value.autoRefreshOnNetworkChange = false;
              if (value.removeAllListeners) value.removeAllListeners();
              if (value._metamask) value._metamask.isUnlocked = () => Promise.resolve(false);
            } catch (e) {
              // Silently ignore any errors when disabling MetaMask
            }
          }
          this._ethereum = value;
        },
        configurable: true
      });
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
